{template 'common/header'}
<title>{$merchname}</title>
<style type="text/css"> 
body {margin:0px; background:#f8f8f8; -moz-appearance:none;}
@font-face {font-family: "iconfont";
  src: url('../addons/sz_yi/template/mobile/style1/static/fonts/iconfont02.eot?t=1474179952'); /* IE9*/
  src: url('../addons/sz_yi/template/mobile/style1/static/fonts/iconfont02.eot?t=1474179952#iefix') format('embedded-opentype'), /* IE6-IE8 */
  url('../addons/sz_yi/template/mobile/style1/static/fonts/iconfont02.woff?t=1474179952') format('woff'), /* chrome, firefox */
  url('../addons/sz_yi/template/mobile/style1/static/fonts/iconfont02.ttf?t=1474179952') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
  url('../addons/sz_yi/template/mobile/style1/static/fonts/iconfont02.svg?t=1474179952#iconfont') format('svg'); /* iOS 4.1- */
}
@font-face {font-family: "iconfont";
  src: url('../addons/sz_yi/template/mobile/style1/shop/fonts/iconfont1.eot?t=1474179952'); /* IE9*/
  src: url('../addons/sz_yi/template/mobile/style1/shop/fonts/iconfont1.eot?t=1474179952#iefix') format('embedded-opentype'), /* IE6-IE8 */
  url('../addons/sz_yi/template/mobile/style1/shop/fonts/iconfont1.woff?t=1474179952') format('woff'), /* chrome, firefox */
  url('../addons/sz_yi/template/mobile/style1/shop/fonts/iconfont1.ttf?t=1474179952') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
  url('../addons/sz_yi/template/mobile/style1/shop/fonts/iconfont1.svg?t=1474179952#iconfont') format('svg'); /* iOS 4.1- */
}
@font-face {font-family: "iconfont";
  src: url('../addons/sz_yi/template/mobile/style1/member/fonts/iconfont.eot?t=1474945964'); /* IE9*/
  src: url('../addons/sz_yi/template/mobile/style1/member/fonts/iconfont.eot?t=1474945964#iefix') format('embedded-opentype'), /* IE6-IE8 */
  url('../addons/sz_yi/template/mobile/style1/member/fonts/iconfont.woff?t=1474945964') format('woff'), /* chrome, firefox */
  url('../addons/sz_yi/template/mobile/style1/member/fonts/iconfont.ttf?t=1474945964') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
  url('../addons/sz_yi/template/mobile/style1/member/fonts/iconfont.svg?t=1474945964#iconfont') format('svg'); /* iOS 4.1- */
} 
.consult_top {height:44px;  background:#fff; padding:0px 3%; border-bottom:1px solid #e3e3e3;}
.consult_top .title {height:44px; width:auto; float:left; font-size:16px; line-height:44px; color:#666;}
.consult_main {margin-top: 5px;padding: 10px;margin-bottom: 65px;overflow-x: hidden;}
.consult_no {width:100%; margin:10px 0px 60px; color:#ccc; font-size:12px; text-align:center;}
#consult_loading { padding:10px;color:#666;text-align: center;}
.consult-form-box{width: 100%; padding-left: 3%; padding-right: 3%;position: fixed;bottom: 60px;}
.consult-content{background: rgb(221, 221, 221); width: 75%; margin-right: 3%; border: 0; padding: 3px 5px; height: 30px; border-radius: 25px;}
.consult-btn{width:20%; border: 0; padding: 3px;  height: 30px; border-radius: 25px;}
.consult{padding: 0px 5px; background: #fff;border-radius:10px;margin-bottom: 10px;} 
.consult .content{font-size: 14px;float: left;} 
.qu-bg{display: inline-block; background: #f3d3bc; color: #fff; padding: 1px;}
.an-bg{display: inline-block; background: #fff; color: #fff; padding: 1px;}
.consult .consult-time,.consult .r-consult-time{font-size: 12px; color: #999;float: right;}
.r-content-box{clear: both;padding-top: 5px;position: relative;}
.r-content-empty{
    padding-bottom: 5px;
}
.sanjiao{ 
    position: absolute;
    width: 0px;
    height: 0px; 
    border: 30px solid;
    border-color: transparent #fff transparent transparent;
    transform: rotateZ(114deg);
    right: -28px;
    bottom: 8px;
   /* top: -19px;*/
    z-index: -1;
}
</style>
  
<div id='container'>
    <div class="consult_top">
        <div class="title" onclick='history.back()'><i class='fa fa-chevron-left'></i> 我的咨询</div> 
    </div>   
    <div class="consult_main"></div>
</div>
<script id='consult_empty' type='text/html'>
     <div class="consult_no">
        <i class="fa fa-question" style="font-size:100px;"></i><br />
        <span style="line-height:18px; font-size:16px;">您暂未咨询过</span><br />快去咨询吧
        <!-- <div class="sanjiao"></div> -->
    </div> 
</script>
<script id='consult_list' type='text/html'>
    <%each list as val%>
    <%if val.type == 1%>
    <div class="consult" data-consultid="" sel='0'>
        <div class="consult-time"></div>
        <div class="r-content-box"> 
            <div class='r-content'><span class="an-bg"></span>&nbsp;<div class="r-consult-time" style="float:left"><%val.time%></div></div>
            <div class="r-content-empty" ><%val.content%></div>
       <div class="sanjiao" style="left:-28px;transform: rotateZ(67deg);"></div> 
        </div><!-- style="text-align: right;" -->
    </div>
    <%else if val.type == 2%>
    <div class="consult" data-consultid="" sel='0'>
        <div class="consult-time"></div>
        <div class="r-content-box">  
            <div class='r-content'><span class="an-bg"></span>&nbsp;<%r_consult%><div class="r-consult-time"><%val.time%></div></div>
            <div class="r-content-empty"><%val.content%></div>
       <div class="sanjiao"></div>
        </div>
    </div>
    <%/if%>
    
   <%/each%>
</script>

<script id='consult_list123' type='text/html'>
    <%each list as consult%> 
    <div class="consult" data-consultid="<%value.id%>" sel='0'>
        <div class='content'><span class="qu-bg">[咨询]</span>&nbsp;<%consult.content%></div>
        <div class="consult-time"><%consult.createtime%></div>
        <div class="r-content-box">
        <%if consult.reply_content!=''%>
            <%each consult.reply_content as r_consult%>
            <div class='r-content'><span class="an-bg">[回复]</span>&nbsp;<%r_consult%><div class="r-consult-time"><%r_consult_time%></div></div>
            <%/each%>
        <%else%>
            <div class="r-content-empty">暂未收到回复</div>
        <%/if%>
        </div>
    </div>
    <%/each%>
</script>

<!-- <script id='consult_list1' type='text/html'> 
    <div class="consult" data-consultid="111" sel='0'>
        <div class='content'><span class="qu-bg">[咨询]</span>&nbsp;怎么退货的?</div>
        <div class="consult-time">2017-06-15 15:10</div>
        <div class="r-content-box">
            <div class='r-content'><span class="an-bg">[回复]</span>&nbsp;请点击链接xxxxxxxxxx<div class="r-consult-time">2017-06-15 15:10</div></div>
            <div class="r-content-empty">暂未收到回复</div>
        </div>
    </div>
     <div class="consult" data-consultid="111" sel='0'>
        <div class='content'><span class="qu-bg">[咨询]</span>&nbsp;怎么退货的?</div>
        <div class="consult-time">2017-06-15 15:10</div>
        <div class="r-content-box">
            <div class='r-content'><span class="an-bg">[回复]</span>&nbsp;请点击链接xxxxxxxxxx<div class="r-consult-time">2017-06-15 15:10</div></div>
            <div class="r-content-empty">暂未收到回复</div>
        </div>
    </div>
</script> -->
<div class="consult-form-box">
    <input type="hidden" name="uid" class="uid" value="这里获取用户id">
    <input type="text" min="1000" class="consult-content" name="content" placeholder="请输入咨询内容...">
    <input type="submit" class="consult-btn" value="提交">
</div>
<script>
    $(function(){
        require(['core'], function( core) {
            $('.consult-btn').click(function(){
                var uid = $('.uid').val();
                var content = $('.consult-content').val();
                    $('.consult-content').val(null);
                if(content.length == 0){ 
                    core.tip.show('咨询内容不能为空哦');
                    return false;
                }
                if(uid.length == 0){
                    core.tip.show('请先登录');
                    return false;
                } 

                var html='<div class="consult" data-consultid="" sel="0">';
                    html+='<div class="consult-time"></div>'; 
                    html+='<div class="r-content-box">';
                    html+='<div class="r-content"><span class="an-bg"></span>&nbsp;<div class="r-consult-time">2018-06-21</div></div>';
                    html+='<div class="r-content-empty">'+content+'</div>';
                    html+='<div class="sanjiao"></div>';
                    html+='</div>';
                    html+='</div>';

                    $(".consult_main").append(html);
                var data = { 
                    op:'post', 
                    "merch_uid" :{$merch_uid}, 
                    'content' : content
                };
                console.log(data); 
                core.json('barter/consult', data, function(json) {
                    console.log(json);
                    if (json.status == 1) {
                        core.tip.show("提交成功"); 
                        window.location.reload();//提交成功后刷新页面
                    } else if (json.status == 0) {
                        core.tip.show(json.result);
                    }
                }, true);
            });
        });
    });
</script>
<script language='javascript'>
    var page= 1;
    require(['tpl', 'core'], function(tpl, core) {
        core.json('barter/consult',{op:'get',merch_uid:{$merch_uid}},function(json){  
            //$('.consult_main').html(tpl('consult_empty') );
            if(json.result.total<=0){ 
                $('.consult_main').html(tpl('consult_empty') ); 
                return;
            }
            //$('.consult_main').html(tpl('consult_list1'));
            console.log(json.result);
            $('.consult_main').html(tpl('consult_list',json.result) );
            var loaded = false;
            var stop=true; 
            $(window).scroll(function(){ 
                if(loaded){
                    return; 
                }
                totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); 
                if($(document).height() <= totalheight){ 
                    if(stop==true){ 
                        stop=false; 
                        $('.consult_main').append('<div id="consult_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载...</div>');
                        page++;
                        core.json('barter/consult', {page:page,op:'get',merch_uid:{$merch_uid}}, function(morejson) {
                            console.log(morejson.result);  
                            stop = true; 
                            $('#consult_loading').remove();
                            $(".consult_main").append(tpl('consult_list', morejson.result));
                            if (morejson.result.list.length <morejson.result.pagesize) {
                                $('.consult_main').append('<div id="consult_loading">已经加载全部消息</div>');
                                loaded = true;
                                $(window).scroll = null;
                                return;
                            }
                        },true); 
                    } 
                } 
            });            
        },true);
    });
</script>
{php $show_footer = true}
{template 'common/footer'}
