<!DOCTYPE html>
<html lang="en" class="am-touch js cssanimations">

	<head>

		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">

		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
		<meta name="viewport" content="initial-scale=1, user-scalable=0, minimal-ui" charset="UTF-8">
		<title>
			好店
		</title>
		<script src="../addons/sz_yi/template/mobile/default/member/merch/js/jquery.js"></script>
			<script src="../addons/sz_yi/template/mobile/default/member/merch/js/jquery.cookie.js"></script>

		<script src="../addons/sz_yi/template/mobile/default/member/merch/js/dropload.min.js"></script>

		<link href="../addons/sz_yi/template/mobile/default/member/merch/css/amazeui.min.css" rel="stylesheet">
		<script src="../addons/sz_yi/template/mobile/default/member/merch/js/amazeui.min.js">
		</script>
		<script src="../addons/sz_yi/template/mobile/default/member/merch/js/layer.js">
		</script>
		<link rel="stylesheet" href="../addons/sz_yi/template/mobile/default/member/merch/css/layer.css" id="layuicss-skinlayercss">
		<!--<link rel="stylesheet" type="text/css" href="minirefresh.min.css"
                />
                -->
		<link rel="stylesheet" type="text/css" href="../addons/sz_yi/template/mobile/default/member/merch/css/minirefresh.min.css" />
		<!--<script src="minirefresh.min.js"></script>-->
		<script src="../addons/sz_yi/template/mobile/default/member/merch/js/minirefresh.min.js">
		</script>
		<style>
		body,
			ul,
			li,
			img,
			p,
			div {
				margin: 0px;
				padding: 0px;
			}
			
			ul,
			li {
				list-style: none
			}
			
			a:link,
			a:visited {
				color: black;
				text-decoration: none;
			}
			
			a:hover {
				color: black;
			}
			
			.clear {
				clear: both
			}
			
			ul {
				display: block;
				height: 90px;
				width: 100%;
				margin: 0;
				padding: 0;
			}
			
			.nav-con {
				border-top: 10px solid white;
				border-bottom: 0px solid #FFFAF5;
			}
			
			.nav-con li {
				/*margin: 5px 0;*/
				padding: 5px 0;
				width: 25%;
				line-height: 30px;
				background-color: #fff;
				font-size: 12px;
				float: left;
				text-align: center;
			}
			
			.nav-con li i {
				display: block;
				width: 52px;
				height: 52px;
				margin: auto;
			}
			
			.nav-con img {
				width: 45px;
				height: 45px;
			}
			
			.reci li {
				float: left;
				margin: 5px;
			}
			
			@-webkit-keyframes opacity {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			
			@keyframes opacity {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
		}
		</style>

		<style>
			* {
				margin: 0;
				padding: 0;
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
				-webkit-text-size-adjust: none;
			}
			
			html {
				font-size: 10px;
			}
			
			body {
				background-color: #f5f5f5;
				font-size: 1.2em;
			}
			
			.header {
				height: 44px;
				line-height: 44px;
				border-bottom: 1px solid #ccc;
				background-color: #eee;
			}
			
			.header h1 {
				text-align: center;
				font-size: 2rem;
				font-weight: normal;
			}
			
			.content-rank {
				max-width: 640px;
				margin: 0 auto;
				background-color: #fff;
			}
			
			.content-rank .item {
				display: -webkit-box;
				display: -webkit-flex;
				display: -ms-flexbox;
				display: flex;
				-ms-flex-align: center;
				-webkit-box-align: center;
				box-align: center;
				-webkit-align-items: center;
				align-items: center;
				padding: 3.125%;
				border-bottom: 1px solid #ddd;
				color: #333;
				text-decoration: none;
			}
			
			.content-rank .item img {
				display: block;
				width: 40px;
				height: 40px;
				border: 1px solid #ddd;
			}
			
			.content-rank .item h3 {
				display: block;
				-webkit-box-flex: 1;
				-webkit-flex: 1;
				-ms-flex: 1;
				flex: 1;
				width: 100%;
				max-height: 40px;
				overflow: hidden;
				line-height: 20px;
				margin: 0 10px;
				font-size: 1.2rem;
			}
			
			.content-rank .item .date {
				display: block;
				height: 20px;
				line-height: 20px;
				color: #999;
			}
			
			.opacity {
				-webkit-animation: opacity 0.3s linear;
				animation: opacity 0.3s linear;
			}
			
			@-webkit-keyframes opacity {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
			
			@keyframes opacity {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}
		</style>
	</head>

	<body style="margin: 0px;">
		<div style="height: 50px;line-height:50px;background-color: #00d3be;position: fixed;top:0;width: 100%;z-index: 1000000000000;">
			<form id="post_form" method="post" action="">
				<input type="hidden" name="typeid" id="typeid" value="" />
				<div style="float:left;margin-left:7%;position:fixed;" onclick="javascript:;">
					<img src="../addons/sz_yi/template/mobile/default/member/merch/img/sousou.png" style="width: 20px;height: 20px;">
				</div>
				<div id="sou">
					<input id="bname" name="bname" type="text" placeholder="搜商家......" style="width: 90%;padding:0 0 0 8%;color:#999;margin-left:5%;border:none;height: 32px;line-height: 32px;border-radius:32px;">
				</div>
			</form>
			<div id="reci" style="background-color: white;line-height:25px;display: none;">
				<div id="qusou" style="float: right;background-color:#00d3be;padding:0 5px 0 5px;border-radius:3px;color:white;margin-right: 10px;margin-top:10px;font-size:13px;">
					确认搜索
				</div>
				<!-- <div style="margin-left:10px;padding-top:10px;">热门搜索</div> -->
				<div class="reci">
					<!-- <ul style="color:#666;margin-left:5px;">						<li>							<span onclick="hot(&#39;酒店&#39;)" style="background-color:#eee;font-size:13px;padding:5px 10px 5px 10px;">酒店</span>						</li>						<li>							<span onclick="hot(&#39;火锅&#39;)" style="background-color:#eee;font-size:13px;padding:5px 10px 5px 10px;">火锅</span>						</li>						<li>							<span onclick="hot(&#39;美食&#39;)" style="background-color:#eee;font-size:13px;padding:5px 10px 5px 10px;">美食</span>						</li>					</ul> -->
				</div>
			</div>
		</div>
		<script>
			$(document).ready(function() {
				$("#sou").click(function() {
					$("#reci").show();
				});
				$("#qusou").click(function() {
					$("#reci").hide();
					var keyword = $('#bname').val();
					var url = "{php echo $this->createMobileUrl('member/merch')}&keyword=" + keyword;
					window.location.href = url;
				});
			});
		</script>
		<div data-am-widget="slider" style="margin-top:45px;" class="am-slider am-slider-a1 am-no-layout" data-am-slider="{&quot;directionNav&quot;:false}">
			<div class="am-viewport" style="overflow: hidden; position: relative;">
				<ul class="am-slides" style="width: 1200%; transition-duration: 0s; transform: translate3d(-375px, 0px, 0px);">
					{loop $set['shop']['thumbs'] $v}
					<li data-thumb-alt="" style="width: 375px; margin-right: 0px; float: left; display: block;" class="">
						<img src="{php echo tomedia($v)}" draggable="false">
					</li>
					{/loop}
				</ul>
			</div>
		</div>
		<div style="border-bottom: 8px solid #eee;line-height:20px;color:#2bb8aa;font-size:14px;">
			<div style="float:left;margin:5px">
				<img src="../addons/sz_yi/template/mobile/default/member/merch/img/gonggao.png" width="23px" height="23px">
			</div>
			<div style="margin-left: 35px;">
				<marquee scrollamount="3" width="100%" style="margin-top:6px;">
					{$set['shop']['title']}
				</marquee>
			</div>
		</div>
		<div class="nav-con">
			<ul>
				{loop $type $v}
				<a href="javascript:type({$v['id']});">
					<li>
						<img src="{php echo tomedia($v['logo'])}">
						<p>
							{$v['title']}
						</p>
					</li>
				</a>
				{/loop}
			</ul>

		</div>
		<div class="clear">
		</div>
		<div style="border-bottom:8px solid #eee;">
		</div>
		<div>
			<div style="border-bottom:3px solid #eee; font-size:14px;color:#2bb8aa;text-align:center;line-height: 35px;">
				- 推荐商家 -
			</div>
			<div id="container">
			</div>

			<div id='content-rank'>
				<div class="min-a">

				</div>
			</div>
		</div>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=2SxShLokVzpxylYYQXNvr4WEQnO5wD8E">
		</script>

		<script type="text/javascript" src="../addons/sz_yi/template/mobile/default/member/merch/js/index.js">
		</script>
		<script>
			var map = new BMap.Map("allmap");
			var longitude, latitude;
			navigator.geolocation.getCurrentPosition(function(position) {
				longitude = '22'; //lng						});			setTimeout(function() {				var gpsPoint = new BMap.Point(longitude, latitude);				BMap.Convertor.translate(gpsPoint, 0, function(point) {					var geoc = new BMap.Geocoder();					geoc.getLocation(point, function(rs) {						var addComp = rs.addressComponents;					});				});			}, 3000);			var page = 1;			$.ajax({				type: "post",				url: "{php echo $this->createMobileUrl('member/merch',array('op'=>'ajaxList'))}",				data: {					lat: latitude,					lng: longitude,					page: page				},				success: function(res) {				}			});			var miniRefresh = new MiniRefresh({				container: '#minirefresh',				down: {					callback: function() {						//下拉刷新						alert(123);					}				},				up: {					callback: function() {					}				}			});
				latitude =  '33'; //lat
				$.cookie('longitude', longitude);
				$.cookie('latitude', latitude);
			});
			
			
			
			console.log(longitude);
			function type(id) {
				var url = "{php echo $this->createMobileUrl('member/merch',array('op'=>'ajaxList'))}";
				var result = "";
				
				console.log(1111);
				console.log(longitude);
				console.log(id);
				console.log(longitude);
				$.ajax({
					type: "post",
					url: url,
					data: {
						typeid: id,
						lng: longitude,
						lat: latitude
					},
					dataType: 'json',
					success: function(res) {
						console.log(res);
						//						if(res.result.list.id==typeid){
						//							
						//						}
						var result = res.result.list.length;
						console.log(result);
						for(var i = 0; i < result; i++) {

						}
					}
				});
			}
			$(function() {

				function getUrlParam(name) {
					var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
					var r = window.location.search.substr(1).match(reg); //匹配目标参数
					if(r != null) return unescape(r[2]);
					return null; //返回参数值
				}
				//获取参数
				var typeid = getUrlParam('typeid');

				//				console.log(member);
				//				var typeidCon = document.getElementById('#typeid');
				//				typeidCon = typeid.val();	

				// 页数
				var page = 1;
				// 每页展示5个
				var size = 5;
				// 下拉刷新
				$('.content-rank').dropload({
					scrollArea: window,
					loadDownFn: function(me) {
						// 拼接HTML
						var result = '';
						$.ajax({
							type: "post",
							url: "{php echo $this->createMobileUrl('member/merch',array('op'=>'ajaxList'))}&page=" + page,
							data: {
								page: page,
								typeid: typeid,
								lng: longitude,
								lat: latitude,

							},
							dataType: 'json',
							success: function(data) {
								var arrLen = data.result.list.length;
								if(arrLen > 0) {
									for(var i = 0; i < arrLen; i++) {
										result += "<a href='" + data.result.list[i].url + "'>" +
											'<div style="color:#808080">' +
											'<div>' +
											'<img  src=' + data.result.list[i].img + '  width="80px" height="80px" style="margin:10px;border-radius:4px;">' +
											'</div>' +
											'<div style="font-size:12px;margin-left:100px;margin-top:-90px;">' +
											'<span style="font-size:16px;color:#4F4F4F;">' +
											data.result.list[i].merchname +
											'</span>' +
											'<br>' +
											'<span style="font-size:13px;">' +
											data.result.list[i].title +
											'</span>' +
											'<br>' +
											'<span>' +
											'<span>' +
											'人均消费' +
											'</span>' +
											'<span style="color:red;">￥' +
											+data.result.list[i].average +
											'</span>' +
											'<span style="float:right;margin-right: 5px;">' +
											+data.result.list[i].distance +
											'km</span>' +
											'</span>' +
											'</div>' +
											'<div style="border-bottom:3px solid #eee;margin-top:5px;padding: 2%;">' +

											'</div>' +
											'</div>' +
											'</a>'
									}
									// 如果没有数据
								} else {

									// 锁定
									me.lock();
									// 无数据
									me.noData();
								}
								// 为了测试，延迟1秒加载
								setTimeout(function() {
									// 插入数据到页面，放到最后面
									$('.min-a').append(result);
									// 每次数据插入，必须重置
									me.resetload();
								}, 1000);
								page++;
							},
							error: function(xhr, type) {
								alert('Ajax error!');
								// 即使加载出错，也得重置
								me.resetload();
							}
						});
					}
				});

			});
		</script>

	</body>

</html>