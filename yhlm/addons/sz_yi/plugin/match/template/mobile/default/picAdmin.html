{template 'common/header'}
<title> 
{if $_GPC['type'] ==1}
    我发布的图片
{else}
    我转发的图片
{/if}
</title><!-- 这里的标签动态获取  --><!-- 安定type==1为我发布的图片 要修改的话改对应的地方就ok了 -->
<style type="text/css">
    html{
        font-size: 10px;
    }
    body{
        background: #eee;
    }
    #big_body{width:100%;margin:0px;}
    .page_topbar{
       background: #009BF8;
    }
    .page_topbar a.back{
        font-family:serif,"PingFang SC", Helvetica, "Helvetica Neue", "微软雅黑", Tahoma, Arial, sans-serif;
        font-weight: bold;
        padding-right: 15px;
        color: #fff;
    }
    .page_topbar .title{
        color: #fff;
    }
    /*flex居中*/
    .flex-center {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }
    .flex-box {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
    }
    .act-title{
        background: #fff;
    }
    .act-title .act-link{
        width: 100%;
        font-size: 16px;
        color: #333;
        padding: 10px;
        text-decoration: none;
    }
    .act-title .act-link .flex1{
        width: calc(100% - 30px);
        line-height: 1.3;
    }
    .act-title .act-link .flex2{
        width: 30px;
        text-align: center;
    }
    .act-title .act-link .flex2 i{
        font-size: 24px;
    }
    .data-box{
        background: #fff;
        padding: 10px 0;
    }
    .data-box .data-item{
        width: calc(100% / 3);
        font-size: 14px;
        color: #333;
        text-align: center;
        border-right: 1px solid #eee;
    }
    .data-box .data-item:last-child{
        border: 0;
    }
    .data-box .data-item .data-item-num{
        display: block;
        color: #999;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .operate-box .op-ul{
        background: #fff; 
        margin-top: 10px;
    }
    .operate-box .op-ul .op-item{
        float: left;
        border-right: 1px solid #eee;
        border-bottom: 1px solid #eee;
    }
    .operate-box .op-item{
        width: calc(100% / 3);
        text-align: center;
        margin: 0;
        padding: 10px 0;
    }
    .operate-box .op-item .op-item-link{
        display: block;
        color: #999;
        line-height: 30px;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-decoration: none;
    }
    .operate-box .op-item .icon-item{
        height: 40px;
        width: 40px;
        line-height: 40px;
        background: #00c1ff;
        color: #fff;
        font-size: 25px;
        margin: 0 auto;
        border-radius: 10px;
        position: relative;
    }
    /*生成海报-邀请海报*/
    .description_layer1{
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.6);
        position: fixed;
        top: 0px;
        left: 0px;
        z-index: 9;
        display: none;
    }
    .description1{
        height: auto;
        width: 96%;
        background: #fff;
        position: fixed;
        z-index: 10;
        display: none;
        left: 50%;
        top: 50%;
        -moz-transform: translate(-50%,-50%);
        -ms-transform: translate(-50%,-50%);
        -o-transform: translate(-50%,-50%);
        -webkit-transform: translate(-50%,-50%);
        transform: translate(-50%,-50%);
    }
    .description1 .description-tag1{
        font-size: 14px;
        padding: 10px;
        background-color: #f1f1f1;
        position: fixed;
        width: 100%;
    }
    .description1 .description-cont1{
        padding: 50px 10px 10px;
        height: auto;
        width: 100%;
        font-size: 12px;
        overflow-x: hidden;
        overflow-y: auto;
    }
    .description1 .close1.icon1{
        position: absolute;
        right: 10px;
        top: 10px;
        color: #666;
        font-weight: normal;
        z-index: 11;
        margin-top:0;
        margin-left:0;
        width:24px;
        height:24px;
    }
    .description1 .close1.icon1:before{
        content:'';
        position:absolute;
        top:10px;
        width:24px;
        height:2px;
        background-color: currentColor;
        -webkit-transform:rotate(-45deg);
        transform:rotate(-45deg);
    }
    .description1 .close1.icon1:after{
        content: '';
        position: absolute;
        top: 10px;
        width: 24px;
        height: 2px;
        background-color: currentColor;
        -webkit-transform: rotate(45deg);
        transform: rotate(45deg);
    }
    .layer-btn-box{
        width: 100%;
    }
    .layer-btn{
        float: left;
        font-size: 14px;
        text-align: center;
        width: 46%;
        margin: 10px 2%;
        padding: 10px;
        background: #009BF8;
        color: #fff;
        border-radius: 5px;
    }
    .cancel-btn{
        background: #999;
    }
    /*生成海报样式*/
    .poster-tpl-box{
        flex-wrap: wrap;
        align-items: stretch;
        max-height: 300px;
        overflow-y: auto;
    }
    .poster-tpl-box .poster-tpl-item1{
        width: 46%;
        margin-right: 2%;
        margin-left: 2%;
        position: relative;
        border: 1px solid #ccc;
        margin-top: 10px;
    }
    .poster-tpl-box .checked-parent,
    .poster-tpl-box .checked-parent1{
        border: 1px solid red;
    }
    .poster-tpl-box .poster-tpl-item1 .tpl-img{
        width: 100%;
        max-width: 100%;
    }
    .poster-tpl-box .poster-tpl-item1 .radio-po-tp1{
        display: none;
    }
    .poster-tpl-box .poster-tpl-item1 .radio-po-lb{
        display: block;
        margin: 0;
    }
    .poster-tpl-box .poster-tpl-item1 .checked-icon{
        width: 30px;
        height: 30px;
        position: absolute;
        right: 0;
        bottom: 0;
        text-align: center;
        font-size: 22px;
        line-height: 30px;
        background: rgba(0,0,0,.5);
        color: #fff;
    }
    .poster-tpl-box .poster-tpl-item1 .no-checked-icon{
        display: none;
    }
</style>
<div id="big_body">
    <div class="page_topbar">
        <a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
        <div class="title">
            {if $_GPC['type'] ==1}
                我发布的图片
            {else}
                我转发的图片
            {/if}
    </div><!-- 这里的标签动态获取 我发布的图片 我转发的图片 -->
    </div>
    <div class="act-title">
        <a href="{php echo $this->createPluginMobileUrl('match/picture',array('op'=>'detail','id'=>$_GPC['id']))}" class="act-link flex-center">
            <span class="flex1">{$picture['title']}</span><!-- 这里应该只能是快捷语了 -->
            <span class="flex2"><i class="fa fa-angle-right trun-right"></i></span>
        </a>
    </div>
    {if $_GPC['type'] == 1}
    <div class="data-box flex-center">
        <div class="data-item">
            阅读          
            <span class="data-item-num">{$picture['browse']}</span>
        </div>
        <div class="data-item">
            转发          
            <span class="data-item-num">{$share}</span>
        </div>
        <div class="data-item">         
            互动
            <span class="data-item-num">{$comment}</span>
        </div>
    </div>
    {/if}
    <div class="operate-box">
        <!-- 下面的两个op-ul 使用内置标签来进行判断是 我转发的活动 还是 我发布的文章 -->
        <!-- 我发布的文章 -->
        {if $_GPC['type'] == 1}
        <ul class="op-ul clearfloat">
            <li class="op-item"> 
                <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('match/picture',array('op'=>'add','id'=>$_GPC['id'],'what'=>'1'))}">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    </div>编辑图片
                </a> 
            </li>                   
            <li class="op-item">                
                <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('activity',array('id'=>$_GPC['id'],'type'=>4,'op'=>'settop'))}">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-arrow-up" aria-hidden="true"></i>
                    </div>置顶推广
                </a> 
            </li>  
            <li class="op-item">
                <a class="op-item-link del-btn" href="javascript:void(0);" data-actid="{$_GPC['id']}">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                    </div>删除      
                </a> 
            </li>
            <li class="op-item"> 
                <a class="op-item-link" href="javascript:void(0);" onclick="showdescription1()">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-picture-o" aria-hidden="true"></i>
                    </div>生成海报
                </a> 
            </li>
        </ul>
        {elseif $_GPC['type'] == 2}     
        <!-- 我转发的图片 -->              
        <ul class="op-ul clearfloat">       
            {if false}                      
                <li class="op-item">      
                    <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('activity/center',array('op'=>'invite','type'=>2,'cate'=>'art','id'=>$_GPC['id']))}">
                        <div class="icon-item" style="background:#44b9c0;">
                            <i class="fa fa-share-square-o" aria-hidden="true"></i>
                        </div>邀约汇总      
                    </a>        
                </li>               
            {/if}    
        </ul>
        {/if}
    </div>
</div>
<!-- 邀请海报模板面板 -->
<!-- 借用说明的类似结构实现蒙层和弹出框 进行邀请海报模选择 -->
<div class="description_layer1"></div> 
<div class="description1">
    <div class="description-tag1">选择邀请海报模板</div>
    <div class="description-cont1"><!-- 邀请模板 注意li的区别 -->
        <ul class="poster-tpl-box flex-box">
            <!-- 默认第一模板被选中 li元素拥有类名checked-parent 其他li没有-->
            {loop $iePoster $k $v}
                {if empty($v['thumb'])}
                    {php continue;}
                {/if}
                {if $k == 0}
                    <li class="poster-tpl-item1 checked-parent1">
                        <!-- 默认第一模板被选中 input radio元素拥有属性checked 其他input radio没有-->
                        <input type="radio" name="radio_b" class="radio-po-tp1" value="{$v['id']}" checked>
                        <label class="radio-po-lb">
                            <img class="tpl-img" src="{php echo tomedia($v['thumb'])}" alt="" disabled="" data-attr="">
                        </label>        
                        <!-- 默认第一模板被选中 i没有类名no-checked-icon 其他i有-->
                        <i class="fa fa-check checked-icon" aria-hidden="true"></i>
                    </li>
                {else}      
                    <li class="poster-tpl-item1">
                        <input type="radio" name="radio_b" class="radio-po-tp1" value="{$v['id']}">
                        <label class="radio-po-lb">
                            <img class="tpl-img" src="{php echo tomedia($v['thumb'])}" alt="" disabled="" data-attr="">
                        </label>         
                        <i class="fa fa-check checked-icon no-checked-icon" aria-hidden="true"></i>
                    </li>
                {/if}
            {/loop}
            
        </ul>
    </div>
    <div class="layer-btn-box clearfloat">
        <div class="layer-btn cancel-btn" onclick="closedescription1()">关闭</div>
        <div class="layer-btn in-poster-btn">确认</div>
    </div>
    <div class="close1 icon1" onclick="closedescription1()"></div>
</div>
<script type="text/javascript">
    require(['tpl', 'core'], function(tpl, core) {
        //删除图片
        $(".del-btn").click(function(){
            core.tip.confirm("确定要删除此图片吗?",function(){
                //删除图片异步请求
                core.json('plugin/match/picture',{op:'delete',id:'{$_GPC['id']}'},function(json){
                    if(json.status==1){
                        //执行成功 需要运行的代码...
                        core.tip.show(json.result);                                                
                        setTimeout(function(){
                            location.href="{php echo $this->createPluginMobileUrl('match/picture',array('op'=>'oneself','status'=>1))}";                  
                        },200);             
                        return;
                    }                   
                    core.tip.show(json.result);
                },true,true);
            });
        });
        //邀请海报模板选择
        $(".poster-tpl-item1").click(function(){
            if($(this).hasClass("checked-parent1")){
                return false;
            }
            $(this).addClass("checked-parent1").find(".checked-icon").removeClass("no-checked-icon");
            $(this).siblings().removeClass("checked-parent1").find(".checked-icon").addClass("no-checked-icon");
            $(this).find(".radio-po-tp1").prop("checked",true);//虽然dom没有显示，但是已有操作
            //console.log($(".radio-po-tp1:checked").val());
        });
        $(".in-poster-btn").click(function(){
            //获取模板的标志值
            var poster_tpl = $(".radio-po-tp1:checked").val();
            var act_id = "{$_GPC['id']}";//这里用内置标签获取活动的id
            var poster_tpl_back = $(".checked-parent1").find(".radio-po-tp1").val();
            if(poster_tpl != poster_tpl_back){
                poster_tpl = poster_tpl_back;
            }
            //console.log(poster_tpl);
            //生成邀请海报海报请求
            location.href='{php echo $this->createPluginMobileUrl('activity/center',array('op'=>'poster'))}&poster_tpl='+poster_tpl+'&what=3&act_id='+act_id;
        });                                                      
    });
    //选择邀请海报模板显示
    function closedescription1(){
        $('.description_layer1').fadeOut(100);
        $('.description1').fadeOut(100);
    }
    function showdescription1(){
        $('.description_layer1').fadeIn(200);
        $('.description_layer1').unbind('click').click(function(){
            closedescription1();
        });
        $('.description1').fadeIn(200);
    }
</script>
{template 'common/footer'}