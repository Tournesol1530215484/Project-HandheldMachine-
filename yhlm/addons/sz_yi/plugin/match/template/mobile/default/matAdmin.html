{template 'common/header'}
<title> 
{if $_GPC['type'] ==1}
    我发布的比赛
{else}
    我参与的比赛
{/if}
</title><!-- 这里的标签动态获取  --><!-- 安定type==1为我发布的比赛 要修改的话改对应的地方就ok了 -->
<style type="text/css">
    html{
        font-size: 10px;
    }
    body{
        background: #eee;
    }
    #big_body{width:100%;margin:0px;}
    .page_topbar{
       background: #009BF8;
    }
    .page_topbar a.back{
        font-family:serif,"PingFang SC", Helvetica, "Helvetica Neue", "微软雅黑", Tahoma, Arial, sans-serif;
        font-weight: bold;
        padding-right: 15px;
        color: #fff;
    }
    .page_topbar .title{
        color: #fff;
    }
    /*flex居中*/
    .flex-center {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }
    .act-title{
        background: #fff;
    }
    .act-title .act-link{
        width: 100%;
        font-size: 16px;
        color: #333;
        padding: 10px;
        text-decoration: none;
    }
    .act-title .act-link .flex1{
        width: calc(100% - 30px);
        line-height: 1.3;
    }
    .act-title .act-link .flex2{
        width: 30px;
        text-align: center;
    }
    .act-title .act-link .flex2 i{
        font-size: 24px;
    }
    .data-box{
        background: #fff;
        padding: 10px 0;
    }
    .data-box .data-item{
        width: calc(100% / 3);
        font-size: 14px;
        color: #333;
        text-align: center;
        border-right: 1px solid #eee;
    }
    .data-box .data-item:last-child{
        border: 0;
    }
    .data-box .data-item .data-item-num{
        display: block;
        color: #999;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .operate-box .op-ul{
        background: #fff; 
        margin-top: 10px;
    }
    .operate-box .op-ul .op-item{
        float: left;
        border-right: 1px solid #eee;
        border-bottom: 1px solid #eee;
    }
    .operate-box .op-item{
        width: calc(100% / 3);
        text-align: center;
        margin: 0;
        padding: 10px 0;
    }
    .operate-box .op-item .op-item-link{
        display: block;
        color: #999;
        line-height: 30px;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-decoration: none;
    }
    .operate-box .op-item .icon-item{
        height: 40px;
        width: 40px;
        line-height: 40px;
        background: #00c1ff;
        color: #fff;
        font-size: 25px;
        margin: 0 auto;
        border-radius: 10px;
        position: relative;
    }
    .description_layer{
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.6);
        position: fixed;
        top: 0px;
        left: 0px;
        z-index: 998;
        display: none;
    }
    .description{
        height: auto;
        width: 96%;
        background: #fff;
        position: fixed;
        z-index: 1000;
        display: none;
        left: 50%;
        top: 50%;
        -moz-transform: translate(-50%,-50%);
        -ms-transform: translate(-50%,-50%);
        -o-transform: translate(-50%,-50%);
        -webkit-transform: translate(-50%,-50%);
        transform: translate(-50%,-50%);
    }
    .description .description-tag{
        font-size: 14px;
        padding: 10px;
        background-color: #f1f1f1;
        position: fixed;
        width: 100%;
    }
    .description .description-cont{
        padding: 50px 10px 10px;
        height: auto;
        width: 100%;
        font-size: 12px;
        overflow-x: hidden;
        overflow-y: auto;
    }
    .description .close.icon{
        position: absolute;
        right: 10px;
        top: 10px;
        color: #666;
        font-weight: normal;
        z-index: 11;
        margin-top:0;
        margin-left:0;
        width:24px;
        height:24px
    }
    .description .close.icon:before{
        content:'';
        position:absolute;
        top:10px;
        width:24px;
        height:2px;
        background-color: currentColor;
        -webkit-transform:rotate(-45deg);
        transform:rotate(-45deg);
    }
    .description .close.icon:after{
        content: '';
        position: absolute;
        top: 10px;
        width: 24px;
        height: 2px;
        background-color: currentColor;
        -webkit-transform: rotate(45deg);
        transform: rotate(45deg);
    }
    .notice-input{
        width: 96%;
        margin: 5px auto;
        border: 1px solid #eee;
        border-radius: 5px;
        padding: 3px;
        outline: none;
        height: 30px;
    }
    .notice-textarea{
        font-size: 14px;
        resize: none;
        width: 96%;
        margin: 5px auto;
        height: 100px;
        border: 1px solid #eee;
        border-radius: 5px;
        padding: 3px;
        outline: none;
    }
    .notice-post-btn{
        font-size: 14px;
        text-align: center;
        width: 96%;
        margin: 10px auto;
        padding: 10px;
        background: #009BF8;
        color: #fff;
        border-radius: 5px;
    }
</style>
<div id="big_body">
    <div class="page_topbar">
        <a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
        <div class="title">
            {if $_GPC['type'] ==1}
                我发布的比赛
            {else}
                我转发的比赛
            {/if}
    </div><!-- 这里的标签动态获取 我发布的比赛 我转发的比赛 -->
    </div>
    <div class="act-title">
        <a href="{php echo $this->createPluginMobileUrl('match/match',array('op'=>'detail','id'=>$_GPC['id']))}" class="act-link flex-center">
            <span class="flex1">{$match['title']}</span><!-- 比赛标题 -->
            <span class="flex2"><i class="fa fa-angle-right trun-right"></i></span>
        </a>                            
    </div>
    {if $_GPC['type'] == 1}
    <div class="data-box flex-center">
        <div class="data-item">
            阅读          
            <span class="data-item-num">{$match['browse']}</span>
        </div>
        <div class="data-item">
            转发          
            <span class="data-item-num">{$share}</span>
        </div>
        <div class="data-item">         
            互动
            <span class="data-item-num">{$comment}</span>
        </div>
    </div>
    {/if}
    <div class="operate-box">
        <!-- 下面的两个op-ul 使用内置标签来进行判断是 我转发的活动 还是 我发布的比赛 -->
        <!-- 我发布的比赛 -->
        {if $_GPC['type'] == 1}
        <ul class="op-ul clearfloat">
            <li class="op-item"> 
                <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('match/match',array('op'=>'add','id'=>$_GPC['id']))}">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    </div>编辑比赛
                </a> 
            </li>                   
            <li class="op-item">                
                <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('activity',array('id'=>$_GPC['id'],'type'=>5,'op'=>'settop'))}">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-arrow-up" aria-hidden="true"></i>
                    </div>置顶推广
                </a>            
            </li>
            <li class="op-item">
                <a class="op-item-link del-match" href="javascript:void(0);">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                    </div>删除比赛      
                </a> 
            </li>  
            <li class="op-item">                
                <a class="op-item-link match-notice" href="javascript:void(0);" onclick="showdescription()">
                    <div class="icon-item" style="background:#c1c554;">
                        <i class="fa fa-comments" aria-hidden="true"></i>
                    </div>比赛通知
                </a> 
            </li>
        </ul>
        <!-- 借用说明的类似结构实现蒙层和弹出框 进行评论-->
        <div class="description_layer"></div> 
        <div class="description">
            <div class="description-tag">比赛通知</div>
            <div class="description-cont">
                <input type="text" name="noticetitle" class="notice-title notice-input" placeholder="通知标题">
                <textarea  class="notice-textarea" placeholder="通知内容(因微信消息字数限制，最多100字)" maxlength="100"></textarea>
                <input type="text" name="noticeurl" class="notice-url notice-input" placeholder="通知url">
            </div>
            <div class="notice-post-btn">提交</div>
            <div class="close icon" onClick="closedescription()"></div>
        </div>
        {elseif $_GPC['type'] == 2}     
        <!-- 我转发的比赛 -->              
        <ul class="op-ul clearfloat">       
            <li class="op-item">    
                <a class="op-item-link" href="{php echo $this->createPluginMobileUrl('match/match',array('op'=>'signup','ro'=>1,'type'=>$_GPC['type'],'id'=>$_GPC['id'],'sgid'=>$sginfo['id']))}">
                    <div class="icon-item" style="background:#44b9c0;">          
                        <i class="fa fa-list-alt" aria-hidden="true"></i>        
                    </div>我的报名
                </a> 
            </li>   
        </ul>
        {/if}
    </div>
</div>
<script type="text/javascript">
    require(['tpl', 'core'], function(tpl, core) {                                  
        //删除活动
        $(".del-match").click(function(){                            
            core.tip.confirm("确定要删除此比赛吗?",function(){
                //删除活动异步请求                      
                core.pjson('match/match',{op:'delete',id:'{$_GPC['id']}'},function(json){
                    if(json.status==1){                                                            
                        //执行成功 需要运行的代码...                               
                        core.tip.show(json.result);
                        setTimeout(function(){
                            location.href="{php echo $this->createPluginMobileUrl('match/match',array('op'=>'myAct','status'=>1))}";                            
                        },200);             
                        return;
                    }
                    core.tip.show(json.result);
                },true,true);
            });
        });
        $(".notice-post-btn").click(function(){
            if($(this).attr('submitting') == '1') { 
                return; 
            }
            if($(".notice-title").isEmpty()){
                core.tip.show('通知标题不能为空');
                return;
            }
            if($(".notice-textarea").isEmpty()){
                core.tip.show('通知内容不能为空');
                return;
            }
            if($(".notice-url").isEmpty()){
                core.tip.show('通知url不能为空');
                return;
            }
            var title = $(".notice-title").val();
            var content = $(".notice-textarea").val();
            var url = $(".notice-url").val();
            //console.table([title,content,url]);
            $(this).attr('submitting', 1);
            core.tip.show('未开通模板消息！');
            return;        
            core.pjson('activity/index', {op:'comment',type:'1',id:'{$_GPC["id"]}',content:content,title:title,url:url}, function(json) {
                //json.status 这里的标识字段随便取，跟后台返回的对应就可以了       
                if (json.status == 1) {
                    $('.notice-post-btn').removeAttr('submitting'); 
                    core.tip.show('操作成功');
                    closedescription();                                                                 
                    return;
                }
                $('.notice-post-btn').removeAttr('submitting');
                core.tip.show(json.result);
            }, true);
        });
    });
    function closedescription(){
        $('.description_layer').fadeOut(100);
        $('.description').fadeOut(100);
    }
    function showdescription(){
        $('.description_layer').fadeIn(200);
        $('.description_layer').unbind('click').click(function(){
            closedescription();
        });
        $('.description').fadeIn(200);
    }
</script>
{template 'common/footer'}