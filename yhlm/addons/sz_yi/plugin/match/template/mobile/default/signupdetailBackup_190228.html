{template 'common/header1116'}
<title>选手个人页</title>
<link rel="stylesheet" href="../addons/sz_yi/plugin/match/res/css/mui.min.css">
<link rel="stylesheet" type="text/css" href="<?php echo MODULE_URL.'plugin/match/res/css/participant_detail.css';?>"/>
<script type="text/javascript" src="../addons/sz_yi/plugin/match/res/js/mui.min.js"></script>
<div class="big_body">
    <div class="page_topbar">
        <a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
        <div class="title">选手个人页</div>
    </div>
    <div class="participant-ad-container">
        <!-- 轮播图 -->
        <div class="mui-slider">
            <div class="mui-slider-group mui-slider-loop">
                <!--支持循环，需要重复图片节点 最大的元素-->
                {php $max=count($banner)-1}   
                {if $banner}
                <div class="mui-slider-item mui-slider-item-duplicate">
                <a href="javascript:void(0);"><img src="{$banner[$max]}" /></a>
                </div>                  
                {/if}
                {loop $banner $key $val}            
                    <div class="mui-slider-item">
                        <a href="javascript:void(0);"><img src="{$val}" /></a>
                    </div>              
                {/loop}
                <!--支持循环，需要重复图片节点 最小的元素-->          
                {if $banner}
                <div class="mui-slider-item mui-slider-item-duplicate">
                    <a href="javascript:void(0);"><img src="{$banner[0]}" /></a>
                </div>                          
                {/if}                                       
                 <!-- 测试s 到时候去掉 -->
                <!-- <div class="mui-slider-item mui-slider-item-duplicate">
                    <a href="http://jhzh66.com/app/index.php?i=8&amp;c=entry&amp;do=barter&amp;m=sz_yi">
                        <img src="http://jhzh66.com/attachment/images/8/2018/10/RuStU1mH55QA944Ztj4q2MjKs4h5AL.jpg">
                    </a>
                </div>      
                                            
                <div class="mui-slider-item mui-active">
                    <a href="http://jhzh66.com//app/index.php?c=site&amp;a=site&amp;do=detail&amp;id=1&amp;i=8">
                        <img src="http://jhzh66.com/attachment/images/8/2018/10/ABthUuaU6ukT2AVVxx1EaZjYtHP7u6.jpg">
                    </a>
                </div>  
                <div class="mui-slider-item">
                    <a href="http://jhzh66.com/app/index.php?i=8&amp;c=entry&amp;do=barter&amp;m=sz_yi">
                        <img src="http://jhzh66.com/attachment/images/8/2018/10/RuStU1mH55QA944Ztj4q2MjKs4h5AL.jpg">
                    </a>
                </div>
                <div class="mui-slider-item mui-slider-item-duplicate">
                    <a href="http://jhzh66.com//app/index.php?c=site&amp;a=site&amp;do=detail&amp;id=1&amp;i=8">
                        <img src="http://jhzh66.com/attachment/images/8/2018/10/ABthUuaU6ukT2AVVxx1EaZjYtHP7u6.jpg">
                    </a>
                </div>  -->
                 <!-- 测试e 到时候去掉 -->
            </div>
            <!-- 轮播图圆点 --> 
            <div class="mui-slider-indicator"> 
                {loop $banner $key $val}         
                    <div class="mui-indicator {if $key == 0} mui-active{/if}"></div>
                {/loop}
            </div> 
        </div>
        <div class="commment-otherbtn" onclick="showdescription()">
            <i class="fa fa-comment comment-icon" aria-hidden="true"></i>
        </div>
    </div>
    <div class="participant-box">
        <div class="name-vote-box flex-center">
            <div class="name-box nowrap">{$info['sgno']}号 {$info['data']['name']['data']}</div>
            <div class="pull-ticket-btn" onclick="share()">拉票+转发</div>
        </div> 
            <div class="desc-box">{$info['picdesc']}</div>
        {loop $info['data'] $k $v}
            {if $k == 'mobile' || $k == 'name'}
                {php continue;}
            {/if}                             
            <div class="desc-box desc-box1">
                {$v['title']} : {if $v['data']}{$v['data']}{else}暂无{/if}
            </div>
        {/loop}           
        <div class="vote-info flex-center">
            <div class="data-box flexbox-item">
                <div class="num nowrap">{$info['sgno']}</div>
                <div class="mark-tag">编号</div>
            </div>          
            <div class="data-box flexbox-item">
                <div class="num nowrap vote-num">{$info['vote']}</div>
                <div class="mark-tag">票数</div>
            </div>
            <div class="data-box flexbox-item">
                <div class="num nowrap sort-num">{$info['no']}</div>
                <div class="mark-tag">排名</div>
            </div>
        </div>                              
    </div>
    <div class="main-btn-box">
        <div class="vote-btn-box same-style-btn"><a class="vote-btn" href="javascript:void(0);">给TA投票</a></div>
        {if $info['openid'] == $openid}
        <div class="edit-btn-box same-style-btn"><a class="edit-link" href="{php echo $this->createPluginMobileUrl('match/match',array('op'=>'apply','id'=>$_GPC['id'],'ac'=>'edit'))}">修改信息</a></div>
        {/if}
        <div class="create-poster-btn"><a class="poster-link" href="javascript:void(0);">去生成海报?</a></div>
    </div>          
    <div class="multiple-container">
        <!-- 点赞部分 -->                   
        <div class="praise-user-container">
            <ul class="praise-user-ul clearfloat">
                <!-- 这里内置标签开始循环li元素  -->                      
                {loop $like $k $v}
                <li class="praise-user-item">
                    <img class="user-icon" src="{$v['avatar']}" onclick="console.log('hi')">
                </li>       
                {/loop}
            </ul>
        </div>
        <!-- 打赏部分 -->
        <div class="reward-user-container">
            <ul class="reward-user-ul">
                <!-- 这里内置标签开始循环li元素  -->
                {loop $reward $k $v}
                    <li class="reward-user-item">
                        <a class="reward-user-link" href="javascript:void(0);" onclick="console.log('hi')" style="color:#000;display:block;text-align:left"><img class="face_reward" src="{$v['avatar']}" style="vertical-align:middle">
                            <span>{$v['nickname']}<!-- {$v['mobile']} --> 支持了 <span style="color:red">{$v['money']}</span>元，{$v['remark']}</span>
                        </a>
                    </li>
                {/loop}
            </ul>
        </div>
        <!-- 评论部分 -->
        <div class="comment-user-container">
            <ul class="comment-user-ul">
                <!-- 这里内置标签开始循环li元素  -->
                {loop $comment $k $v}
                    <li class="comment-user-item">
                        <a class="comment-user-link" href="javascript:void(0);" onclick="console.log('hi')" style="color:#000;display:block;text-align:left"><img class="face_comment" src="{$v['avatar']}" style="vertical-align:middle">      
                            <span>{$v['nickname']} {$v['content']}</span>
                        </a>
                    </li>
                {/loop}
            </ul>
        </div>
        <div class="btn-container-0">
            <ul class="btn-box clearfloat">
                <li class="btn-item praise-btn-item">
                    <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                </li>
                <!--这里是跳转到打赏界面
                    <a class="btn-link" href="{php echo $this->createPluginMobileUrl('match/center',array('op'=>'reward','type'=>'6','id'=>$_GPC['id'],'sgid'=>$_GPC['sgid']))}">赏</a>
                </li>     -->   
                <li class="btn-item reward-btn-item" style="background: #fee3a0;"><!-- 这里是跳转到打赏界面 -->
                    <a class="btn-link" style="color: #f00;" href="{php echo $this->createPluginMobileUrl('match/center',array('op'=>'reward','type'=>'6','id'=>$_GPC['id'],'sgid'=>$_GPC['sgid']))}">赏</a>
                </li>                                                    
                <li class="btn-item comment-btn-item" onclick="showdescription()">评</li>
                <li class="btn-item"><!-- 这里是跳转到帮助手册(文章) -->
                    <a class="btn-link" href="{php echo $this->createPluginMobileUrl('article/article')}"><i class="fa fa-question" aria-hidden="true"></i></a>
                </li>
            </ul>                                                   
        </div>
        <div class="btn-container-0 btn-container-2">
            <ul class="btn-box clearfloat">
                <li class="btn-item"><!-- 这里是跳转到发活动 -->
                    <a class="btn-link" href="{php echo $this->createPluginMobileUrl('match/picture',array('op'=>'add'))}">发图片</a>
                </li>                   
                <li class="btn-item"><!-- 这里是跳转到发文章 -->
                    <a class="btn-link" href="{php echo $this->createPluginMobileUrl('activity/article',array('op'=>'add'))}">发文章</a>
                </li>
                <li class="btn-item"><!-- 这里是跳转到关注平台-->
                    <a class="btn-link" href="{php echo murl('site', array('do' =>'detail','id'=>9), true, true)}">关注平台</a>
                </li>
                <li class="btn-item"><!-- 这里是跳转到打卡 -->
                    <a class="btn-link" href="{php echo $this->createPluginMobileUrl('activity/center')}">每日打卡</a>
                </li>
            </ul>       
        </div>
    </div>
    <div style="width: 100%; height: 50px;"></div>
    {template 'common/nav_matchparticipant'}
    <!-- 回到顶部功能按键 -->
    <div class="go-to-top-con">
        <a class="gotop" id="gotop" data-i=""><i class="fa fa-caret-up icon-block" aria-hidden="true"></i>TOP</a>
    </div>

    <!-- 借用说明的类似结构实现蒙层和弹出框 进行评论-->
    <div class="description_layer"></div> 
    <div class="description">
        <div class="description-tag">评论</div>
        <div class="description-cont"><!-- 评论输入框 -->
           <textarea class="comment-textarea" placeholder="最多50字" maxlength="50"></textarea>
        </div>
        <div class="comment-post-btn">提交</div>
        <div class="close icon" onClick="closedescription()"></div>
    </div>
    <!-- 分享提示 -->
    <div id="share_cover">
        <img src="../addons/sz_yi/plugin/match/res/images/commonguide_share.png">
    </div>
    <!-- 生成海报 -->
    <div id="poster_cover">
        <div class="poster-box">
            <img class="poster-img" src="">
            <div class="closeposter-btn">关闭</div>
        </div>
    </div>
</div>
<!-- 点赞记录模板 当用户点赞时用到 填充两个数据点赞用户头像和用户的打卡界面链接-->
<script  id="tpl_praise" type="text/html">
    <li class="praise-user-item">
        <img class="user-icon" src="<%member.avatar%>" onclick="console.log('hi')">
    </li>
</script>
<script type="text/javascript">
    //浏览                
    // $.post('{php echo $this->createPluginMobileUrl("activity/index",array("op"=>"browse"))}',{id:'{$_GPC["id"]}',type:'2'},function(e){},'json');
        
    require(['tpl', 'core'], function(tpl, core) {              
        //轮播图
        var gallery = mui('.mui-slider');
        gallery.slider({
          interval:2000//自动轮播周期，若为0则不自动播放，默认为0；
        });            
        menushowheight();
        
        $(window).scroll(function() {
            menushowheight();  
        });
        $("#gotop").click(function(){
            $("html,body").stop().animate({scrollTop: 0}, 500);
        });
        $(".praise-btn-item").click(function(){
            //var user_id = "1";//这里赋值用户的id 或者不用复制，后台是知道哪个用户点赞?
            if ($(this).attr('submitting') == '1') { 
                return; 
            } 
            $('.praise-btn-item').attr('submitting', 1);
            core.pjson('activity/index', {op:'sglike',sgid:'{$_GPC['sgid']}',id:'{$_GPC["id"]}'}, function(json) {
                //json.status 这里的标识字段随便取，跟后台返回的对应就可以了       
                if (json.status == 1) { 
                    $('.praise-btn-item').removeAttr('submitting');            
                    core.tip.show('加油成功','bottom',500);         
                    $(".praise-user-ul").append(tpl('tpl_praise',json.result));
                    return;      
                }           
                $('.praise-btn-item').removeAttr('submitting');
                core.tip.show('你已经加油过了','bottom',500);
            }, true);

        });
        $(".comment-post-btn").click(function(){
            if($(".comment-textarea").isEmpty()){           
                core.tip.show('评论不能为空');
                return;
            }
            var comment = $(".comment-textarea").val();         
            core.pjson('activity/index', {op:'sgcomment',sgid:'{$_GPC['sgid']}',id:'{$_GPC["id"]}',comment: comment}, function(json) {
                //json.status 这里的标识字段随便取，跟后台返回的对应就可以了       
                if (json.status == 1) {
                    core.tip.show('评论成功！');//评论不会即时出现,需要审核,也就是刷新页面的时候才可能会出现评论(才加载)
                    // $(".comment-user-ul").append(tpl('tpl_praise'),json.result);
                    closedescription();   
                    window.location.reload();                                                                        
                    return;
                }                                           
                core.tip.show(json.result);             
            }, true);                                   
        });
        //投票按钮
        $(".vote-btn").unbind("click").click(function(e){
            if($(this).attr('submitting') == '1') { 
                return; 
            }
            $(this).attr('submitting', 1);
            //到时候改异步请求url   赛者id-pid和比赛id-id
            core.pjson('match/match', {op:'vote',sgid:'{$_GPC['sgid']}',type:'1',id:'{$_GPC['id']}'}, function(json) {
                //json.status 这里的标识字段随便取，跟后台返回的对应就可以了
                if (json.status == 1) {         
                    $('.vote-btn').removeAttr('submitting');  
                    core.tip.show('操作成功','bottom',500);              
                    $('.vote-num').text(json.result.vote);        
                    return;      
                }           
                $('.vote-btn').removeAttr('submitting');
                core.tip.show(json.result,'bottom',500);
            }, true);
        });     
        //生成海报
        $(".poster-link").click(function(){
            if($(this).attr('submitting') == '1') { 
                return; 
            }                   
            $(this).attr('submitting', 1);                      
            //到时候改异步请求url   赛者id-pid和比赛id-id
            core.pjson('match/match', {op:'getposter',sgid:'{$_GPC['sgid']}',id:'{$_GPC['id']}'}, function(json) {
                //json.status 这里的标识字段随便取，跟后台返回的对应就可以了
                if (json.status == 1) {                                        
                    $('.poster-link').removeAttr('submitting');                                  
                    //core.tip.show('操作成功','bottom',500);                                
                    //赋值海报图片路径
                    $(".poster-img").attr("src",json.result);               
                    showPoster();           
                    return;      
                }
                $('.poster-link').removeAttr('submitting');
                core.tip.show(json.result,'bottom',500);
            }, true);
        });
        //显示海报
        function showPoster(){
            $('#poster_cover').fadeIn(200);
            $(".closeposter-btn").unbind('click').click(function(){
                $('#poster_cover').fadeOut(100);
            });
        }
        
    });
    function menushowheight(){
        var bt=$(window).scrollTop();
        if(bt>=400){
            $("#gotop").slideDown(200);
            $("#gotop").attr({"data-i":"1"});
        }else{
            $("#gotop").slideUp(200);
            $("#gotop").attr({"data-i":""});
        }
    }
    function closedescription(){
        $('.description_layer').fadeOut(100);
        $('.description').fadeOut(100);
    }
    function showdescription(){
        $('.description_layer').fadeIn(200);
        $('.description_layer').unbind('click').click(function(){
            closedescription();
        });
        $('.description').fadeIn(200);
    }
    //给TA拉票
    function share(){
        $('#share_cover').fadeIn(200).unbind('click').click(function(){
            $(this).fadeOut(100);
        });
    }
</script>
{template 'common/footer'}