{template 'common/header'}
<script src="../addons/sz_yi/static/js/dist/ajaxfileupload.js" type="text/javascript"></script>
<title>供应商申请</title>
<style type="text/css">
    body {margin:0px; background:#efefef; font-family:'微软雅黑'; -moz-appearance:none;}
    .info_main {height:auto;  background:#fff; margin-top:14px; border-bottom:1px solid #e8e8e8; border-top:1px solid #e8e8e8;}
    .info_main .line {margin:0 10px; height:40px; border-bottom:1px solid #e8e8e8; line-height:40px; color:#999;}
    .info_main .line .title {height:40px; width:80px; line-height:40px; color:#444; float:left; font-size:16px;}
    .info_main .line .info { width:100%;float:right;margin-left:-80px;}
    .info_main .line .inner { margin-left:80px; }
    .info_main .line .inner input {height:38px; width:100%;display:block; padding:0px; margin:0px; border:0px; float:left; font-size:16px;}
    .info_main .line .inner .user_sex {line-height:40px;}
    .info_sub {height:44px; margin:14px 5px; background:#31cd00; border-radius:4px; text-align:center; font-size:16px; line-height:44px; color:#fff;}
	.info_sub1 {height:44px; margin:14px 5px; background:#31cd00; border-radius:4px; text-align:center; font-size:16px; line-height:44px; color:#fff;}
    .select { border:1px solid #ccc;height:25px;}
    
    .plus{position: relative;}
    .plus i { left:7px;top:7px;position: absolute;}
    .plus .id_number{position:absolute;width:30px;height:30px;-webkit-tap-highlight-color: transparent;filter:alpha(Opacity=0); opacity: 0;}
    .images {width:auto;height:30px;}
    .images .img { float:left; position:relative;width:30px;height:30px;border:1px solid #e9e9e9;margin-right:5px;}
    .images .img img { position:absolute;top:0; width:100%;height:100%;}
    .images .img .minus { position:absolute;color:red;width:8px;height:12px;top:-15px;right:-1px;}
</style>
<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2.js" type="text/javascript"></script>
<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2-zh.js" type="text/javascript"></script>
<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.core-2.5.2.css" rel="stylesheet" type="text/css" />
<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.animation-2.5.2.css" rel="stylesheet" type="text/css" />
<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.datetime-2.5.1.js" type="text/javascript"></script>
<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.datetime-2.5.1-zh.js" type="text/javascript"></script>
<script src="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.android-ics-2.5.2.js" type="text/javascript"></script>
<link href="../addons/sz_yi/static/js/dist/mobiscroll/mobiscroll.android-ics-2.5.2.css" rel="stylesheet" type="text/css" />

<div id="container"></div>
<script id="member_info" type="text/html">
    <div class="page_topbar">
		<a href="javascript:;" class="back" onclick="history.back()"><i class="fa fa-angle-left"></i></a>
		<div class="title">供应商申请</div>
	</div>
	<?php if(empty($af_supplier)){?>
    <div class="info_main">
        <div class="line">
            <div class="title">
                用户名
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='username' placeholder="请输入用户名" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                密码
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='password' placeholder="请输入密码" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                姓名
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='realname' placeholder="请输入您的姓名" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                手机号码
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='mobile' placeholder="请输入您的手机号码" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                微信号
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='weixin' placeholder="请输入微信号" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                产品名称
            </div>
            <div class='info'>
                <div class='inner'>
                    <input type="text" id='productname' placeholder="请输入产品名称" value=""/>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                身份证上面
            </div>
            <div class='info'>
                <div class='inner'>
                    <div class="plus">
                        <i class="fa fa-plus"></i>
                        <input type="file" id='id_number1' class="id_number" data-name='1' name='imgFile1' placeholder="请上传身份证上面照片"/>
                    </div>
                    <div class="images images1"></div>
                </div>
            </div>
        </div>
        <div class="line">
            <div class="title">
                身份证反面
            </div>
            <div class='info'>
                <div class='inner'>
                    <div class="plus">
                        <i class="fa fa-plus"></i>
                        <input type="file" id='id_number2' class="id_number" data-name='2' name='imgFile2' placeholder="请上传身份证反面照片"/>
                    </div>
                    <div class="images images2"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="info_sub">
        提交申请
    </div>
	<?php }?>
	<?php if(!empty($af_supplier)){?>
		<div style="text-align:center;font-size:20px">
      <div style="background:#00c1ff;width:50px;height:50px;border-radius:50%;margin:10px auto;color:#fff;line-height: 50px;"><i style="font-size:28px" class="fa fa-check"></i></div>
			<div class="title">您已经提交过申请了</div>
		</div>
		<div class="info_sub1">确定</div>
	<?php }?>
</script>
<script id="tpl_img" type="text/html">
    <div class='img' data-img='<%filename%>'>
       <img src='<%url%>'/>
       <div class='minus'><i class='fa fa-minus-circle'></i></div>
   </div>
</script>
<script language="javascript">

    require(['tpl', 'core'], function(tpl, core) {
        core.pjson('supplier/af_supplier',{},function(json){
            if (json.result.member) {
                var data = json.result.member;
                $('#container').html(tpl('member_info', data));
                $('.id_number').change(function () {
                    core.loading('正在上传');
                    var name = $(this).data('name');
                    // return;
                    $.ajaxFileUpload({
                        url: core.getUrl('util/uploader'),
                        data: {file: "imgFile" + name},
                        secureuri: false, 
                        fileElementId: 'id_number'+name, 
                        dataType: 'json', 
                        success: function(res, status) {
                            core.removeLoading();
                            var to = 1;
                            if (name == 2) {
                                to = 2;
                            }
                            core.pjson('supplier/af_supplier',{op: 'update', url: res.url, to: to},function(json){
                                // 保存图片入库
                            });
                            var obj = $(tpl('tpl_img', res));
                            $('.images'+name).append(obj);
                            $('.minus').click(function() {
                                core.json('util/uploader', {op: 'remove', file: $(obj).data('img')}, function(rjson) {
                                    if (rjson.status == 1) {
                                        $(obj).remove();
                                    }
                                    $('.images' + name).prev('.plus').show();
                                }, false, true);
                            });
                            if ($('.images' + name).find('.img').length >= 1) {
                                $('.images' + name).prev('.plus').hide();
                            }
                        }, error: function(data, status, e) {
                            core.removeLoading();
                            core.tip.show('上传失败!');
                        }
                    });
                });
                
				$('.info_sub1').click(function(){
				    window.location.href="<?php echo $this->createMobileUrl('member/center')?>";
				});

                $('.info_sub').click(function() {
                    
                    if($(this).attr('saving')=='1')
                    {
                        return;
                    }
                    if( $('#username').isEmpty()){
                       core.tip.show('请输入用户名!');
                       return;
                    }
                    if( $('#password').isEmpty()){
                       core.tip.show('请输入密码!');
                       return;
                    }
                    if( $('#realname').isEmpty()){
                       core.tip.show('请输入姓名!');
                       return;
                    }
                    if(!$('#mobile').isMobile()){
                       core.tip.show('请输入正确手机号码!');
                       return;
                    }
                    if( $('#weixin').isEmpty()){
                       core.tip.show('请输入微信号!');
                       return;
                    }
                    if( $('#productname').isEmpty()){
                       core.tip.show('请输入产品名!');
                       return;
                    }
                    /*if( $('#sel-provance').val() == '请选择省份'){
                       core.tip.show('请选择省份');
                       return;
                    }
                    if( $('#sel-city').val() == '请选择城市'){
                       core.tip.show('请选择城市');
                       return;
                    }
                    if( $('#sel-area').val() == '请选择地区'){
                       core.tip.show('请选择地区');
                       return;
                    }*/
                    var front   = $('.images1').find('.img');
                    var unfront = $('.images2').find('.img');
                    if (front.length != 1) {
                        core.tip.show('请上传身份证正面照片!');
                        return;
                    }
                    if (unfront.length != 1) {
                        core.tip.show('请上传身份证反面照片!');
                        return;
                    }
                   $(this).html('正在处理...').attr('saving',1);
                    core.pjson('supplier/af_supplier', {
                       'memberdata':{
                            'username': $('#username').val(),
                            'password': $('#password').val(),
                            'realname': $('#realname').val(),
                            'mobile': $('#mobile').val(),
                            'weixin': $('#weixin').val(),
                            /*'productname': $('#productname').val(),
                            'provance': $('#sel-provance').val(),
                            'city': $('#sel-city').val(),
							'area': $('#sel-area').val(),*/
                        }
                    }, function(json) {
                       console.log(json);
                        if(json.status==1){
                             core.tip.show('提交申请成功');
                             {if !empty($_GPC['returnurl'])}
                                 location.href="{php echo urldecode($_GPC['returnurl'])}";
                             {else}
                                 location.href="{php echo $this->createMobileUrl('member')}";
                             {/if}
                        }else if(json.status==2){
                          $('.info_sub').html('确认').removeAttr('saving');
                            core.tip.show('用户名已存在');
                        }else{
                          $('.info_sub').html('确认').removeAttr('saving');
                            core.tip.show('提交申请失败!');
                        }
                    },true,true);
                })
            }
        });
    })
</script>

{template 'common/footer'}